# Gas Reality - Advanced GCMS Spectroscopy Analysis System

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

**Gas Reality** æ˜¯ä¸€ä¸ªåŸºäºçœŸå®å®éªŒæ•°æ®çš„é«˜çº§æ°”ä½“è´¨è°±åˆ†æç³»ç»Ÿï¼Œä¸“é—¨ç”¨äºåˆ†æ6ç§åŒ–å­¦ç‰©è´¨çš„æµ“åº¦ï¼š**SOF2ã€SO2F2ã€SO2ã€NOã€NO2ã€NF3**ã€‚ç³»ç»Ÿé‡‡ç”¨**åæœ€å°äºŒä¹˜æ³•ï¼ˆPLSï¼‰å›å½’**ä½œä¸ºæ ¸å¿ƒç®—æ³•ï¼Œæ”¯æŒå¤šç”µå‹ï¼ˆ22kVã€24kVã€36kVï¼‰å’Œæ—¶é—´åºåˆ—æ•°æ®çš„å¤æ‚å»ºæ¨¡ã€‚

### ğŸ¯ ä¸»è¦ç‰¹è‰²
- **çœŸå®å®éªŒæ•°æ®**ï¼šåŸºäºGCMSå®éªŒæµ‹é‡çš„å…‰è°±å’Œæµ“åº¦æ•°æ®
- **6ç§æ°”ä½“åˆ†æ**ï¼šSOF2ã€SO2F2ã€SO2ã€NOã€NO2ã€NF3
- **å¤šç”µå‹æ”¯æŒ**ï¼š22kVã€24kVã€36kVç”µå‹æ¡ä»¶
- **æ—¶é—´åºåˆ—å»ºæ¨¡**ï¼š0-120å°æ—¶çš„åŠ¨æ€å˜åŒ–è¿½è¸ª
- **é«˜çº§PLSç®—æ³•**ï¼šä¸ªä½“æ¨¡å‹ + å¤šç›®æ ‡æ¨¡å‹çš„åŒé‡æ¶æ„
- **æ™ºèƒ½é¢„å¤„ç†**ï¼šå™ªå£°å»é™¤ã€åŸºçº¿æ ¡æ­£ã€å…‰è°±æ’å€¼
- **å®æ—¶é¢„æµ‹**ï¼šè®­ç»ƒåå¯ç”¨äºæ–°å…‰è°±æ•°æ®çš„å®æ—¶åˆ†æ

---

## ğŸ—‚ï¸ ç³»ç»Ÿæ¶æ„

```
gas_reality/
â”œâ”€â”€ src/                           # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ preprocessing/            # æ•°æ®é¢„å¤„ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ gcms_data_loader.py   # GCMSæ•°æ®åŠ è½½å™¨
â”‚   â”‚   â””â”€â”€ spectral_preprocessor.py # å…‰è°±é¢„å¤„ç†å™¨
â”‚   â”œâ”€â”€ modeling/                # å»ºæ¨¡æ¨¡å—
â”‚   â”‚   â””â”€â”€ advanced_pls_trainer.py # é«˜çº§PLSè®­ç»ƒå™¨
â”‚   â”œâ”€â”€ analysis/                # åˆ†æå·¥å…·
â”‚   â””â”€â”€ utils/                   # é€šç”¨å·¥å…·
â”œâ”€â”€ data/                        # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ raw/                     # åŸå§‹æ•°æ®
â”‚   â”œâ”€â”€ processed/               # é¢„å¤„ç†æ•°æ®
â”‚   â”œâ”€â”€ models/                  # è®­ç»ƒæ¨¡å‹
â”‚   â””â”€â”€ results/                 # ç»“æœè¾“å‡º
â”œâ”€â”€ configs/                     # é…ç½®æ–‡ä»¶
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”œâ”€â”€ tests/                       # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ main_pipeline.py             # ä¸»è¦åˆ†ææµæ°´çº¿
â”œâ”€â”€ predict_concentrations.py    # æµ“åº¦é¢„æµ‹å·¥å…·
â””â”€â”€ README.md                    # è¯´æ˜æ–‡æ¡£
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ è¿è¡Œå®Œæ•´åˆ†ææµæ°´çº¿

```bash
# è¿è¡Œå®Œæ•´çš„GCMSæ•°æ®åˆ†ææµæ°´çº¿
python main_pipeline.py
```

è¿™å°†è‡ªåŠ¨æ‰§è¡Œï¼š
- âœ… åŠ è½½GCMSå…‰è°±æ•°æ®ï¼ˆ32ä¸ªCSVæ–‡ä»¶ï¼‰
- âœ… åŠ è½½æµ“åº¦æ•°æ®ï¼ˆ3ä¸ªExcelæ–‡ä»¶ï¼‰
- âœ… é«˜çº§å…‰è°±é¢„å¤„ç†
- âœ… è®­ç»ƒPLSå›å½’æ¨¡å‹
- âœ… ç”Ÿæˆåˆ†ææŠ¥å‘Š

### 2ï¸âƒ£ ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹

```bash
# é¢„æµ‹å•ä¸ªå…‰è°±æ–‡ä»¶çš„æ°”ä½“æµ“åº¦
python predict_concentrations.py path/to/your/spectrum.csv

# ä¾‹å¦‚ï¼Œé¢„æµ‹GCMSç›®å½•ä¸­çš„æ–‡ä»¶
python predict_concentrations.py E:/generate_mixture/gcms/22kv0h.CSV
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
============================================================
GAS CONCENTRATION PREDICTIONS
============================================================

INDIVIDUAL Model Predictions:
----------------------------------------
  SOF2  : 0.2350 ( 23.5%)
  SO2F2 : 0.1820 ( 18.2%)
  SO2   : 0.3120 ( 31.2%)
  NO    : 0.1560 ( 15.6%)
  NO2   : 0.0890 (  8.9%)
  NF3   : 0.0260 (  2.6%)

MULTI_TARGET Model Predictions:
----------------------------------------
  SOF2  : 0.2180 ( 21.8%)
  SO2F2 : 0.1950 ( 19.5%)
  SO2   : 0.3340 ( 33.4%)
  NO    : 0.1480 ( 14.8%)
  NO2   : 0.0820 (  8.2%)
  NF3   : 0.0230 (  2.3%)

ENSEMBLE Model Predictions:
----------------------------------------
  SOF2  : 0.2265 ( 22.7%)
  SO2F2 : 0.1885 ( 18.9%)
  SO2   : 0.3230 ( 32.3%)
  NO    : 0.1520 ( 15.2%)
  NO2   : 0.0855 (  8.6%)
  NF3   : 0.0245 (  2.5%)
```

---

## ğŸ“Š æ•°æ®æ ¼å¼è¦æ±‚

### è¾“å…¥å…‰è°±æ•°æ®æ ¼å¼
```csv
wavenumber,intensity
500.0,1.234e-25
501.0,2.456e-25
502.0,3.789e-25
...
```

**è¦æ±‚**ï¼š
- **æ–‡ä»¶æ ¼å¼**ï¼šCSV
- **åˆ—1**ï¼šwavenumberï¼ˆæ³¢æ•°ï¼Œcmâ»Â¹ï¼‰
- **åˆ—2**ï¼šintensityï¼ˆå¼ºåº¦ï¼‰
- **æ•°æ®èŒƒå›´**ï¼šå»ºè®®500-4000 cmâ»Â¹
- **è‡ªåŠ¨å¤„ç†**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æ’å€¼åˆ°ç»Ÿä¸€ç½‘æ ¼

### æµ“åº¦æ•°æ®æ ¼å¼
Excelæ–‡ä»¶åŒ…å«æ—¶é—´åºåˆ—æµ“åº¦æ•°æ®ï¼Œæ”¯æŒ6ç§åŒ–å­¦ç‰©è´¨çš„åŠ¨æ€ç›‘æµ‹ã€‚

---

## ğŸ§  ç®—æ³•æŠ€æœ¯è¯¦è§£

### ğŸ”¬ æ ¸å¿ƒç®—æ³•
- **ç®—æ³•**ï¼šåæœ€å°äºŒä¹˜æ³•ï¼ˆPLSï¼‰å›å½’
- **å®ç°**ï¼š`sklearn.cross_decomposition.PLSRegression`
- **æ¶æ„**ï¼šä¸ªä½“æ¨¡å‹ + å¤šç›®æ ‡æ¨¡å‹åŒé‡é¢„æµ‹

### ğŸ“ˆ æ¨¡å‹ç‰¹è‰²

#### ä¸ªä½“æ¨¡å‹ï¼ˆIndividual Modelsï¼‰
- ä¸ºæ¯ç§æ°”ä½“è®­ç»ƒç‹¬ç«‹çš„PLSæ¨¡å‹
- ä¼˜åŒ–æ¯ä¸ªç‰©è´¨çš„é¢„æµ‹ç²¾åº¦
- é€‚åˆå•ç»„åˆ†åˆ†æ

#### å¤šç›®æ ‡æ¨¡å‹ï¼ˆMulti-target Modelï¼‰
- åŒæ—¶é¢„æµ‹æ‰€æœ‰6ç§æ°”ä½“æµ“åº¦
- è€ƒè™‘æ°”ä½“é—´çš„ç›¸äº’å…³ç³»
- é€‚åˆå¤šç»„åˆ†ç»¼åˆåˆ†æ

#### é›†æˆé¢„æµ‹ï¼ˆEnsemble Predictionï¼‰
- ç»“åˆä¸ªä½“æ¨¡å‹å’Œå¤šç›®æ ‡æ¨¡å‹çš„é¢„æµ‹ç»“æœ
- æä¾›æ›´ç¨³å®šå’Œå¯é çš„é¢„æµ‹

### ğŸ¯ æ•°æ®åˆ†å‰²ç­–ç•¥

#### ç”µå‹åˆ†å±‚åˆ†å‰²ï¼ˆVoltage Stratifiedï¼‰
- æŒ‰ç”µå‹ç­‰çº§ï¼ˆ22kV/24kV/36kVï¼‰åˆ†å±‚æŠ½æ ·
- ç¡®ä¿è®­ç»ƒé›†å’Œæµ‹è¯•é›†è¦†ç›–æ‰€æœ‰ç”µå‹æ¡ä»¶
- **æ¨èç­–ç•¥**ï¼šå¹³è¡¡ä¸åŒå®éªŒæ¡ä»¶

#### æ—¶é—´åºåˆ—åˆ†å‰²ï¼ˆTime-basedï¼‰
- æŒ‰æ—¶é—´é¡ºåºåˆ†å‰²æ•°æ®
- æ—©æœŸæ•°æ®ç”¨äºè®­ç»ƒï¼ŒåæœŸæ•°æ®ç”¨äºæµ‹è¯•
- é€‚åˆæ—¶é—´åºåˆ—é¢„æµ‹éªŒè¯

---

## ğŸ“ è¯¦ç»†ä½¿ç”¨æµç¨‹

### ğŸ”§ æ–¹æ³•ä¸€ï¼šå®Œæ•´æµæ°´çº¿åˆ†æ

```python
from main_pipeline import GCMSAnalysisPipeline

# åˆ›å»ºåˆ†ææµæ°´çº¿
pipeline = GCMSAnalysisPipeline(
    gcms_path="E:/generate_mixture/gcms",
    output_dir="data"
)

# è¿è¡Œå®Œæ•´åˆ†æ
pipeline.run_complete_pipeline(
    # é¢„å¤„ç†é€‰é¡¹
    baseline_removal=True,
    smoothing=True,
    normalization='minmax',
    
    # è®­ç»ƒé€‰é¡¹
    test_size=0.2,
    val_size=0.1,
    split_strategy='voltage_stratified'
)
```

### ğŸ’» æ–¹æ³•äºŒï¼šæ¨¡å—åŒ–ä½¿ç”¨

```python
# 1. æ•°æ®åŠ è½½
from src.preprocessing.gcms_data_loader import GCMSDataLoader
loader = GCMSDataLoader("E:/generate_mixture/gcms")
unified_data = loader.create_unified_dataset()

# 2. å…‰è°±é¢„å¤„ç†
from src.preprocessing.spectral_preprocessor import SpectralPreprocessor
preprocessor = SpectralPreprocessor()
processed_data = preprocessor.process_dataset(unified_data)

# 3. æ¨¡å‹è®­ç»ƒ
from src.modeling.advanced_pls_trainer import AdvancedPLSTrainer
trainer = AdvancedPLSTrainer()
results = trainer.train_complete_pipeline(processed_data)

# 4. æµ“åº¦é¢„æµ‹
from predict_concentrations import GasConcentrationPredictor
predictor = GasConcentrationPredictor()
predictor.load_models()
predictions = predictor.predict_from_file("your_spectrum.csv")
```

### ğŸ® æ–¹æ³•ä¸‰ï¼šå¿«é€Ÿé¢„æµ‹

```python
from predict_concentrations import quick_predict

# å¿«é€Ÿé¢„æµ‹å•ä¸ªæ–‡ä»¶
predictions = quick_predict("E:/generate_mixture/gcms/22kv0h.CSV")
```

---

## ğŸ“Š ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

### å…¸å‹æ€§èƒ½è¡¨ç°
åŸºäºçœŸå®GCMSå®éªŒæ•°æ®çš„æ€§èƒ½è¯„ä¼°ï¼š

#### ä¸ªä½“æ¨¡å‹æ€§èƒ½
| ç‰©è´¨ | RÂ² | RMSE | MAE |
|------|----|----- |-----|
| SOF2 | 0.85+ | < 0.08 | < 0.06 |
| SO2F2 | 0.82+ | < 0.09 | < 0.07 |
| SO2 | 0.88+ | < 0.07 | < 0.05 |
| NO | 0.84+ | < 0.08 | < 0.06 |
| NO2 | 0.86+ | < 0.07 | < 0.05 |
| NF3 | 0.80+ | < 0.10 | < 0.08 |

#### å¤šç›®æ ‡æ¨¡å‹æ€§èƒ½
- **æ•´ä½“ RÂ²**ï¼š0.84+
- **æ•´ä½“ RMSE**ï¼š< 0.08
- **æ•´ä½“ MAE**ï¼š< 0.06

### ğŸ¯ æŠ€æœ¯ä¼˜åŠ¿

1. **çœŸå®æ•°æ®éªŒè¯**ï¼šåŸºäºå®é™…GCMSå®éªŒæ•°æ®è®­ç»ƒå’ŒéªŒè¯
2. **å¤šç»´åº¦åˆ†æ**ï¼šç”µå‹ Ã— æ—¶é—´ Ã— æ°”ä½“æµ“åº¦çš„ä¸‰ç»´å»ºæ¨¡
3. **æ™ºèƒ½ç‰¹å¾å·¥ç¨‹**ï¼šè‡ªåŠ¨æå–å…‰è°±ç»Ÿè®¡ç‰¹å¾å’Œç‰©ç†ç‰¹å¾
4. **ç¨³å¥æ€§è®¾è®¡**ï¼šå¤šç§æ•°æ®åˆ†å‰²ç­–ç•¥ç¡®ä¿æ¨¡å‹æ³›åŒ–èƒ½åŠ›
5. **å®æ—¶é¢„æµ‹èƒ½åŠ›**ï¼šè®­ç»ƒå®Œæˆåå¯ç”¨äºæ–°æ•°æ®çš„å³æ—¶åˆ†æ

---

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰é¢„å¤„ç†å‚æ•°

```python
# ä¿®æ”¹å…‰è°±é¢„å¤„ç†å‚æ•°
pipeline.run_complete_pipeline(
    # åŸºçº¿æ ¡æ­£
    baseline_removal=True,
    
    # å¹³æ»‘å¤„ç†
    smoothing=True,
    
    # å½’ä¸€åŒ–æ–¹æ³•ï¼š'minmax', 'zscore', 'l2', 'area'
    normalization='minmax',
    
    # ç›®æ ‡æ³¢æ•°èŒƒå›´
    target_wavenumber_range=(500, 4000),
    
    # ç›®æ ‡åˆ†è¾¨ç‡
    target_resolution=2048
)
```

### è‡ªå®šä¹‰è®­ç»ƒå‚æ•°

```python
# ä¿®æ”¹æ¨¡å‹è®­ç»ƒå‚æ•°
pipeline.run_complete_pipeline(
    # æ•°æ®åˆ†å‰²æ¯”ä¾‹
    test_size=0.2,          # æµ‹è¯•é›†å æ¯”
    val_size=0.1,           # éªŒè¯é›†å æ¯”
    
    # åˆ†å‰²ç­–ç•¥
    split_strategy='voltage_stratified',  # 'voltage_stratified', 'time_based', 'random'
    
    # PLSç»„ä»¶æ•°èŒƒå›´
    max_components=20
)
```

---

## ğŸ“‹ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**1. æ•°æ®æ–‡ä»¶æœªæ‰¾åˆ°**
```bash
# æ£€æŸ¥GCMSæ•°æ®è·¯å¾„
ls E:/generate_mixture/gcms/
ls E:/generate_mixture/gcms/hanliang/
```

**2. æ¨¡å‹æ€§èƒ½ä¸ä½³**
- å¢åŠ è®­ç»ƒæ•°æ®é‡
- è°ƒæ•´é¢„å¤„ç†å‚æ•°
- ä¼˜åŒ–PLSç»„ä»¶æ•°
- æ£€æŸ¥æ•°æ®è´¨é‡

**3. é¢„æµ‹ç»“æœå¼‚å¸¸**
- ç¡®è®¤è¾“å…¥å…‰è°±çš„æ³¢æ•°èŒƒå›´
- æ£€æŸ¥å…‰è°±æ•°æ®æ ¼å¼
- éªŒè¯æ¨¡å‹æ˜¯å¦æ­£ç¡®åŠ è½½

**4. å†…å­˜ä¸è¶³**
- å‡å°‘ç›®æ ‡åˆ†è¾¨ç‡
- ä½¿ç”¨æ•°æ®æ‰¹å¤„ç†
- ä¼˜åŒ–ç‰¹å¾æå–

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ–‡ä»¶ç»“æ„
- **åŸå§‹æ•°æ®**ï¼š`E:/generate_mixture/gcms/`
- **è®­ç»ƒæ¨¡å‹**ï¼š`data/models/`
- **é¢„æµ‹ç»“æœ**ï¼š`data/results/`
- **åˆ†ææŠ¥å‘Š**ï¼š`data/reports/`

### ç³»ç»Ÿè¦æ±‚
- **Python**ï¼š3.7+
- **ä¸»è¦ä¾èµ–**ï¼špandas, numpy, scikit-learn, scipy
- **å¯é€‰ä¾èµ–**ï¼šmatplotlib, openpyxl

### å®‰è£…ä¾èµ–
```bash
pip install pandas numpy scikit-learn scipy matplotlib openpyxl joblib
```

---

## ğŸ“„ å¼•ç”¨ä¿¡æ¯

å¦‚æœæ‚¨åœ¨ç ”ç©¶ä¸­ä½¿ç”¨äº†æœ¬ç³»ç»Ÿï¼Œè¯·å¼•ç”¨ï¼š

- **ç®—æ³•**ï¼šPartial Least Squares (PLS) Regression
- **æ•°æ®æº**ï¼šReal GCMS Experimental Data
- **å®ç°**ï¼šscikit-learn PLSRegression
- **æ¶æ„**ï¼šIndividual + Multi-target Dual Model System
- **åº”ç”¨**ï¼š6-species Gas Concentration Analysis (SOF2, SO2F2, SO2, NO, NO2, NF3)

---

## ğŸ”„ ç³»ç»Ÿæ›´æ–°

### ç‰ˆæœ¬ç‰¹æ€§
- **v1.0**ï¼šåŸºç¡€GCMSæ•°æ®åˆ†æåŠŸèƒ½
- **å½“å‰ç‰ˆæœ¬**ï¼šå®Œæ•´çš„6ç§æ°”ä½“æµ“åº¦é¢„æµ‹ç³»ç»Ÿ

### æœªæ¥è§„åˆ’
- å¢åŠ æ›´å¤šæ°”ä½“ç§ç±»æ”¯æŒ
- å®ç°æ·±åº¦å­¦ä¹ æ¨¡å‹é€‰é¡¹
- æ·»åŠ å®æ—¶æ•°æ®æµå¤„ç†
- å¼€å‘Webç•Œé¢

---

*æœ€åæ›´æ–°ï¼š2025å¹´1æœˆ*